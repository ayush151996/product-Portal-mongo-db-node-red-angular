!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("localforage")):"function"==typeof define&&define.amd?define("ngforage",["exports","@angular/core","localforage"],t):t((e=e||self).ngforage={},e.ng.core,e.localforage)}(this,function(e,t,r){"use strict";var n="default"in r?r["default"]:r,i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function o(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function c(e,t){Object.defineProperty(e.prototype,Symbol.toStringTag,{configurable:!1,enumerable:!1,value:t||e.name,writable:!1})}var s=function(){function e(e,t){this.data=e,this.expires=new Date("number"==typeof t?t:0)}return Object.defineProperty(e.prototype,"expired",{get:function(){var e=0===this.expiresIn;return e&&Object.defineProperty(this,"expired",{value:e}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expiresIn",{get:function(){var e=Math.max(0,this.expires.getTime()-Date.now());return e||Object.defineProperty(this,"expiresIn",{value:e}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasData",{get:function(){var e=null!=this.data;return Object.defineProperty(this,"hasData",{value:e}),e},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{data:this.data,expired:this.expired,expires:this.expires,expiresIn:this.expiresIn,hasData:this.hasData}},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();c(s,"CachedItem");var a,u,f="defineDriver"in r?r:n,p={INDEXED_DB:f.INDEXEDDB,LOCAL_STORAGE:f.LOCALSTORAGE,WEB_SQL:f.WEBSQL};try{for(var g=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}([f.INDEXEDDB,f.LOCALSTORAGE,f.WEBSQL]),h=g.next();!h.done;h=g.next()){var l=h.value;delete p[l]}}catch(z){a={error:z}}finally{try{h&&!h.done&&(u=g["return"])&&u.call(g)}finally{if(a)throw a.error}}Object.freeze(p);var d=new t.InjectionToken("Default NgForage config"),y=Symbol("Default Config"),b=function(){function e(e){this[y]={cacheTime:3e5,description:"",driver:[p.INDEXED_DB,p.WEB_SQL,p.LOCAL_STORAGE],name:"ngForage",size:4980736,storeName:"ng_forage",version:1},e&&this.configure(e)}return Object.defineProperty(e.prototype,"cacheTime",{get:function(){return this[y].cacheTime},set:function(e){this[y].cacheTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return{cacheTime:this.cacheTime,description:this.description,driver:this.driver,name:this.name,size:this.size,storeName:this.storeName,version:this.version}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this[y].description},set:function(e){this[y].description=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driver",{get:function(){return"string"==typeof this[y].driver?this[y].driver:this[y].driver.slice()},set:function(e){this[y].driver=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this[y].name},set:function(e){this[y].name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this[y].size},set:function(e){this[y].size=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeName",{get:function(){return this[y].storeName},set:function(e){this[y].storeName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this[y].version},set:function(e){this[y].version=e},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return(e=e||{}).driver&&e.driver.slice&&(e.driver=e.driver.slice()),Object.assign(this[y],e),this},e.prototype.defineDriver=function(e){return f.defineDriver(e)},e.prototype.toJSON=function(){return this.config},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Optional},{type:t.Inject,args:[d]}]}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(d,8))},token:e,providedIn:"root"}),e}();c(b);var m={};var v=Symbol("Config"),j=function(){function e(e){this[v]=e}return e.prototype.getInstance=function(e){var t=function(e){return[(t=e.driver,t?Array.isArray(t)?t.slice().sort().join(","):t:""),e.name,e.size,e.storeName,e.version,e.description,e.cacheTime].join("|");var t}(e=Object.assign({},this[v].config,e||{}));return m[t]||(m[t]=f.createInstance(e)),m[t]},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:b}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(b))},token:e,providedIn:"root"}),e}();c(j);var O=Symbol("Store"),I=function(){function e(e,t){this.config={},this.baseConfig=e,this.fact=t}return Object.defineProperty(e.prototype,"description",{get:function(){return this.config.description||this.baseConfig.description},set:function(e){this.config.description=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driver",{get:function(){return this.config.driver||this.baseConfig.driver},set:function(e){this.config.driver=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.config.name||this.baseConfig.name},set:function(e){this.config.name=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.config.size||this.baseConfig.size},set:function(e){this.config.size=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeName",{get:function(){return this.config.storeName||this.baseConfig.storeName},set:function(e){this.config.storeName=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return"version"in this.config?this.config.version:this.baseConfig.version},set:function(e){this.config.version=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"finalConfig",{get:function(){return Object.assign({},this.baseConfig.config,this.config)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"store",{get:function(){return!this.storeNeedsRecalc&&this[O]||(this[O]=this.fact.getInstance(this.finalConfig),this.storeNeedsRecalc=!1),this[O]},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return e=e||{},Array.isArray(e.driver)&&(e.driver=e.driver.slice()),Object.assign(this.config,e),this.storeNeedsRecalc=!0,this},e.prototype.toJSON=function(){return{description:this.description,driver:this.driver,name:this.name,size:this.size,storeName:this.storeName,version:this.version}},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.ctorParameters=function(){return[{type:b,decorators:[{type:t.Inject,args:[b]}]},{type:j,decorators:[{type:t.Inject,args:[j]}]}]},e}();c(I,"BaseConfigurable"),Object.defineProperty(I,"storeNeedsRecalc",{configurable:!0,enumerable:!0,value:!0,writable:!0});var N=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return o(r,e),Object.defineProperty(r.prototype,"activeDriver",{get:function(){return this.store.driver()},enumerable:!0,configurable:!0}),r.prototype.clear=function(){return this.store.clear()},r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r.prototype.getItem=function(e){return this.store.getItem(e)},r.prototype.iterate=function(e){return this.store.iterate(e)},r.prototype.key=function(e){return this.store.key(e)},r.prototype.keys=function(){return this.store.keys()},r.prototype.length=function(){return this.store.length()},r.prototype.ready=function(){return this.store.ready()},r.prototype.removeItem=function(e){return this.store.removeItem(e)},r.prototype.setItem=function(e,t){return this.store.setItem(e,t)},r.prototype.supports=function(e){return this.store.supports(e)},r.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],r.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new r(t.ɵɵinject(b),t.ɵɵinject(j))},token:r,providedIn:"root"}),r}(I);function C(e){return{data:e+"_data",expiry:e+"_expiry"}}function P(e){return new s(e[0],e[1])}function D(e){return e[0]}function S(){}c(N);var x=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return o(r,e),Object.defineProperty(r.prototype,"cacheTime",{get:function(){return this.config.cacheTime||this.baseConfig.cacheTime},set:function(e){this.config.cacheTime=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r.prototype.getCached=function(e){var t=C(e),r=this.getItem(t.data),n=this.getItem(t.expiry);return Promise.all([r,n]).then(P)},r.prototype.removeCached=function(e){var t=C(e),r=this.removeItem(t.data),n=this.removeItem(t.expiry);return Promise.all([r,n]).then(S)},r.prototype.setCached=function(e,t,r){var n=C(e),i="number"==typeof r?r:this.cacheTime,o=this.setItem(n.data,t),c=this.setItem(n.expiry,Date.now()+i);return Promise.all([o,c]).then(D)},r.prototype.toJSON=function(){var t={cacheTime:this.cacheTime};return Object.assign(e.prototype.toJSON.call(this),t)},r.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],r.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new r(t.ɵɵinject(b),t.ɵɵinject(j))},token:r,providedIn:"root"}),r}(N);c(x);var T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.clone=function(e){var r=new t(this.baseConfig,this.fact);return r.configure(Object.assign(this.finalConfig,e||{})),r},t}(x);c(T,"NgForageCache (dedicated)");var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.clone=function(e){var r=new t(this.baseConfig,this.fact);return r.configure(Object.assign(this.finalConfig,e||{})),r},t}(N);c(w,"NgForage (dedicated)");var _=Symbol("NgForageConfig"),E=Symbol("InstanceFactory"),F=function(){function e(e,t){this[_]=e,this[E]=t}return e.prototype.createCache=function(e){var t=new T(this[_],this[E]);return e&&t.configure(e),t},e.prototype.createNgForage=function(e){var t=new w(this[_],this[E]);return e&&t.configure(e),t},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:b},{type:j}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(b),t.ɵɵinject(j))},token:e,providedIn:"root"}),e}();c(F);var R=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:d,useValue:t?Object.assign({},t):{}}]}},e.decorators=[{type:t.NgModule,args:[{}]}],e}();e.BaseConfigurableImpl=I,e.CachedItemImpl=s,e.DEFAULT_CONFIG=d,e.DedicatedInstanceFactory=F,e.Driver=p,e.InstanceFactory=j,e.NgForage=N,e.NgForageCache=x,e.NgForageCacheDedicated=T,e.NgForageConfig=b,e.NgForageDedicated=w,e.NgForageModule=R,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngforage.umd.min.js.map