import * as tslib_1 from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { NSnackbarService } from '../../n-snackbar.service';
var SnackbarComponent = /** @class */ (function () {
    function SnackbarComponent(snackbarService) {
        var _this = this;
        this.snackbarService = snackbarService;
        this.max = 1;
        this.onAdd = new EventEmitter();
        this.onRemove = new EventEmitter();
        this.onClear = new EventEmitter();
        this.snacks = [];
        this.snackbarService.get()
            .subscribe(function (snack) {
            if (snack.action === 'add') {
                _this.add(snack.data);
            }
            else if (snack.action === 'remove') {
                _this.remove(snack.id);
            }
            else if (snack.action === 'clear') {
                _this.clear();
            }
        });
    }
    SnackbarComponent.prototype.add = function (snack) {
        var _this = this;
        var timeout;
        var id = this.uuid();
        if (this.max && this.max > 0 && this.snacks.length === this.max) {
            this.remove(this.snacks[0].id);
        }
        if (snack.timeout || this.timeout) {
            timeout = setTimeout(function () {
                _this.remove(id);
            }, snack.timeout || this.timeout);
        }
        var data = Object.assign({ id: id, timeoutObj: timeout }, snack);
        if (snack.action) {
            var that_1 = this;
            var fcn_1 = snack.action.onClick || new Function();
            snack.action.onClick = function () {
                fcn_1(data);
                that_1.remove(id);
            };
        }
        if (snack.onAdd) {
            snack.onAdd(data);
        }
        if (this.onAdd) {
            this.onAdd.emit(data);
        }
        this.snacks.push(data);
    };
    SnackbarComponent.prototype.remove = function (id) {
        var snack = this.snacks.find(function (obj) { return obj.id === id; });
        if (snack) {
            if (snack.onRemove) {
                snack.onRemove(snack);
            }
            if (this.onRemove) {
                this.onRemove.emit(snack);
            }
            if (snack.timeoutObj) {
                clearTimeout(snack.timeoutObj);
            }
        }
        this.snacks = this.snacks.filter(function (obj) { return obj.id !== id; });
    };
    SnackbarComponent.prototype.clear = function () {
        // this.snacks.forEach(snack => {
        //   this.remove(snack.id);
        // });
        this.snacks = [];
        if (this.onClear) {
            this.onClear.emit(true);
        }
    };
    SnackbarComponent.prototype.uuid = function () {
        // tslint:disable:no-bitwise
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        // tslint:enable:no-bitwise
    };
    SnackbarComponent.prototype.calcTextColor = function (background) {
        if (!background) {
            return null;
        }
        function hexToRgb(hex) {
            var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(shorthandRegex, function (m, r, g, b) {
                return r + r + g + g + b + b;
            });
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }
        var rgb = hexToRgb(background);
        if (!rgb) {
            return null;
        }
        var color = [rgb.r / 255, rgb.g / 255, rgb.b / 255];
        for (var i = 0; i < color.length; ++i) {
            if (color[i] <= 0.03928) {
                color[i] = color[i] / 12.92;
            }
            else {
                color[i] = Math.pow((color[i] + 0.055) / 1.055, 2.4);
            }
        }
        var l = 0.2126 * color[0] + 0.7152 * color[1] + 0.0722 * color[2];
        if (l > 0.179) {
            return '#000';
        }
        else {
            return '#fff';
        }
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], SnackbarComponent.prototype, "position", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], SnackbarComponent.prototype, "max", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], SnackbarComponent.prototype, "background", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], SnackbarComponent.prototype, "accent", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], SnackbarComponent.prototype, "color", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], SnackbarComponent.prototype, "customClass", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], SnackbarComponent.prototype, "timeout", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], SnackbarComponent.prototype, "onAdd", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], SnackbarComponent.prototype, "onRemove", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], SnackbarComponent.prototype, "onClear", void 0);
    SnackbarComponent = tslib_1.__decorate([
        Component({
            selector: 'n-snackbar',
            template: "\n      <div class=\"snackbars\" [ngClass]=\"position || 'bottom-center'\">\n          <n-snack   *ngFor=\"let snackbar of snacks\" [background]=\"snackbar.background || background\"\n                        [customClass]=\"snackbar.customClass || customClass\"\n                        [color]=\"snackbar.color || color || calcTextColor(snackbar.background || background)\">\n              <div class=\"container\">\n              <div class=\"snack-text child\" >\n                  {{snackbar.msg}}\n              </div>\n              <div *ngIf=\"snackbar.action.text\" class=\"snack-action\" (click)=\"snackbar.action.onClick()\"\n                   [ngStyle]=\"{color: snackbar.action.color || accent}\">\n                  {{snackbar.action.text}}\n              </div>\n              </div>\n          </n-snack>\n      </div>\n  ",
            styles: [".snack-action{cursor:pointer;color:#2196f3;font-weight:700}.container{display:flex;flex-direction:row;flex-wrap:wrap}.child{width:60%;flex:1 0;margin-right:.5em}.snackbars.bottom-center{align-items:middle;left:50%;transform:translate(-50%,0);bottom:1px;align-items:center}.snackbars{position:fixed;z-index:99999;max-width:100%;word-wrap:break-word;display:inline;font-family:Roboto;letter-spacing:1px}.snack{padding:1em;border-radius:.3em;max-height:50vh;overflow:auto}"]
        }),
        tslib_1.__metadata("design:paramtypes", [NSnackbarService])
    ], SnackbarComponent);
    return SnackbarComponent;
}());
export { SnackbarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic25hY2tiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmV1dHJpbm9zLXNlZWQtc2VydmljZXMvIiwic291cmNlcyI6WyJzcmMvYXBwL25ldXRyaW5vcy1zZWVkLXNlcnZpY2VzL3NuYWNrYmFyL3NuYWNrYmFyL3NuYWNrYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQXVCNUQ7SUFtQkUsMkJBQW9CLGVBQWlDO1FBQXJELGlCQVdDO1FBWG1CLG9CQUFlLEdBQWYsZUFBZSxDQUFrQjtRQWpCNUMsUUFBRyxHQUFXLENBQUMsQ0FBQztRQU9SLFVBQUssR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNuRCxhQUFRLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdEQsWUFBTyxHQUEwQixJQUFJLFlBQVksRUFBVyxDQUFDO1FBRTlFLFdBQU0sR0FJRCxFQUFFLENBQUM7UUFHTixJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRTthQUN2QixTQUFTLENBQUMsVUFBQSxLQUFLO1lBQ2QsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLEtBQUssRUFBRTtnQkFDMUIsS0FBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDdEI7aUJBQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLFFBQVEsRUFBRTtnQkFDcEMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7YUFDdkI7aUJBQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLE9BQU8sRUFBRTtnQkFDbkMsS0FBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ2Q7UUFDSCxDQUFDLENBQUMsQ0FBQztJ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a0RBQWlCO0lBQ2hCO1FBQVIsS0FBSyxFQUFFOzt5REFBb0I7SUFDbkI7UUFBUixLQUFLLEVBQUU7O3FEQUFnQjtJQUNmO1FBQVIsS0FBSyxFQUFFOztvREFBZTtJQUNkO1FBQVIsS0FBSyxFQUFFOzswREFBa0I7SUFDakI7UUFBUixLQUFLLEVBQUU7O3NEQUFpQjtJQUVmO1FBQVQsTUFBTSxFQUFFOzBDQUFlLFlBQVk7b0RBQWdDO0lBQzFEO1FBQVQsTUFBTSxFQUFFOzBDQUFrQixZQUFZO3VEQUFnQztJQUM3RDtRQUFULE1BQU0sRUFBRTswQ0FBaUIsWUFBWTtzREFBd0M7SUFYbkUsaUJBQWlCO1FBckI3QixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsWUFBWTtZQUN0QixRQUFRLEVBQUUseTBCQWdCVDs7U0FFRixDQUFDO2lEQW9CcUMsZ0JBQWdCO09BbkIxQyxpQkFBaUIsQ0F1SjdCO0lBQUQsd0JBQUM7Q0FBQSxBQXZKRCxJQXVKQztTQXZKWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTlNuYWNrYmFyU2VydmljZSB9IGZyb20gJy4uLy4uL24tc25hY2tiYXIuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ24tc25hY2tiYXInLFxuICB0ZW1wbGF0ZTogYFxuICAgICAgPGRpdiBjbGFzcz1cInNuYWNrYmFyc1wiIFtuZ0NsYXNzXT1cInBvc2l0aW9uIHx8ICdib3R0b20tY2VudGVyJ1wiPlxuICAgICAgICAgIDxuLXNuYWNrICAgKm5nRm9yPVwibGV0IHNuYWNrYmFyIG9mIHNuYWNrc1wiIFtiYWNrZ3JvdW5kXT1cInNuYWNrYmFyLmJhY2tncm91bmQgfHwgYmFja2dyb3VuZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICBbY3VzdG9tQ2xhc3NdPVwic25hY2tiYXIuY3VzdG9tQ2xhc3MgfHwgY3VzdG9tQ2xhc3NcIlxuICAgICAgICAgICAgICAgICAgICAgICAgW2NvbG9yXT1cInNuYWNrYmFyLmNvbG9yIHx8IGNvbG9yIHx8IGNhbGNUZXh0Q29sb3Ioc25hY2tiYXIuYmFja2dyb3VuZCB8fCBiYWNrZ3JvdW5kKVwiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzbmFjay10ZXh0IGNoaWxkXCIgPlxuICAgICAgICAgICAgICAgICAge3tzbmFja2Jhci5tc2d9fVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiAqbmdJZj1cInNuYWNrYmFyLmFjdGlvbi50ZXh0XCIgY2xhc3M9XCJzbmFjay1hY3Rpb25cIiAoY2xpY2spPVwic25hY2tiYXIuYWN0aW9uLm9uQ2xpY2soKVwiXG4gICAgICAgICAgICAgICAgICAgW25nU3R5bGVdPVwie2NvbG9yOiBzbmFja2Jhci5hY3Rpb24uY29sb3IgfHwgYWNjZW50fVwiPlxuICAgICAgICAgICAgICAgICAge3tzbmFja2Jhci5hY3Rpb24udGV4dH19XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L24tc25hY2s+XG4gICAgICA8L2Rpdj5cbiAgYCxcbiAgc3R5bGVVcmxzOiBbJy4vc25hY2tiYXIuc3R5bGUuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgU25hY2tiYXJDb21wb25lbnQge1xuICBASW5wdXQoKSBwb3NpdGlvbjogJ3RvcC1sZWZ0JyB8ICd0b3AtY2VudGVyJyB8ICd0b3AtcmlnaHQnIHwgJ2JvdHRvbS1sZWZ0JyB8ICdib3R0b20tY2VudGVyJyB8ICdib3R0b20tcmlnaHQnO1xuICBASW5wdXQoKSBtYXg6IG51bWJlciA9IDE7XG4gIEBJbnB1dCgpIGJhY2tncm91bmQ6IHN0cmluZztcbiAgQElucHV0KCkgYWNjZW50OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGNvbG9yOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGN1c3RvbUNsYXNzOiBhbnk7XG4gIEBJbnB1dCgpIHRpbWVvdXQ6IG51bWJlcjtcblxuICBAT3V0cHV0KCkgcHVibGljIG9uQWRkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgcHVibGljIG9uUmVtb3ZlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgcHVibGljIG9uQ2xlYXI6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICBzbmFja3M6IEFycmF5PHtcbiAgICBpZDogc3RyaW5nLCBtc2c6IHN0cmluZywgdGltZW91dD86IG51bWJlciwgY29sb3I/OiBzdHJpbmcsIGJhY2tncm91bmQ/OiBzdHJpbmcsIGN1c3RvbUNsYXNzPzogYW55LCBhY3Rpb24/OiB7XG4gICAgICB0ZXh0OiBzdHJpbmcsIG9uQ2xpY2s/OiBGdW5jdGlvbiwgY29sb3I/OiBzdHJpbmdcbiAgICB9LCBvbkFkZD86IEZ1bmN0aW9uLCBvblJlbW92ZT86IEZ1bmN0aW9uLCB0aW1lb3V0T2JqPzogYW55XG4gIH0+ID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzbmFja2JhclNlcnZpY2U6IE5TbmFja2JhclNlcnZpY2UpIHtcbiAgICB0aGlzLnNuYWNrYmFyU2VydmljZS5nZXQoKVxuICAgICAgLnN1YnNjcmliZShzbmFjayA9PiB7XG4gICAgICAgIGlmIChzbmFjay5hY3Rpb24gPT09ICdhZGQnKSB7XG4gICAgICAgICAgdGhpcy5hZGQoc25hY2suZGF0YSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc25hY2suYWN0aW9uID09PSAncmVtb3ZlJykge1xuICAgICAgICAgIHRoaXMucmVtb3ZlKHNuYWNrLmlkKTtcbiAgICAgICAgfSBlbHNlIGlmIChzbmFjay5hY3Rpb24gPT09ICdjbGVhcicpIHtcbiAgICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgYWRkKHNuYWNrKSB7XG4gICAgbGV0IHRpbWVvdXQ7XG4gICAgY29uc3QgaWQgPSB0aGlzLnV1aWQoKTtcblxuICAgIGlmICh0aGlzLm1heCAmJiB0aGlzLm1heCA+IDAgJiYgdGhpcy5zbmFja3MubGVuZ3RoID09PSB0aGlzLm1heCkge1xuICAgICAgdGhpcy5yZW1vdmUodGhpcy5zbmFja3NbMF0uaWQpO1xuICAgIH1cblxuICAgIGlmIChzbmFjay50aW1lb3V0IHx8IHRoaXMudGltZW91dCkge1xuICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnJlbW92ZShpZCk7XG4gICAgICB9LCBzbmFjay50aW1lb3V0IHx8IHRoaXMudGltZW91dClcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gT2JqZWN0LmFzc2lnbih7IGlkOiBpZCwgdGltZW91dE9iajogdGltZW91dCB9LCBzbmFjayk7XG5cbiAgICBpZiAoc25hY2suYWN0aW9uKSB7XG4gICAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICAgIGNvbnN0IGZjbiA9IHNuYWNrLmFjdGlvbi5vbkNsaWNrIHx8IG5ldyBGdW5jdGlvbigpO1xuICAgICAgc25hY2suYWN0aW9uLm9uQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIGZjbihkYXRhKTtcbiAgICAgICAgdGhhdC5yZW1vdmUoaWQpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoc25hY2sub25BZGQpIHtcbiAgICAgIHNuYWNrLm9uQWRkKGRhdGEpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9uQWRkKSB7XG4gICAgICB0aGlzLm9uQWRkLmVtaXQoZGF0YSk7XG4gICAgfVxuXG4gICAgdGhpcy5zbmFja3MucHVzaChkYXRhKTtcbiAgfVxuXG4gIHJlbW92ZShpZCkge1xuICAgIGNvbnN0IHNuYWNrID0gdGhpcy5zbmFja3MuZmluZChvYmogPT4gb2JqLmlkID09PSBpZCk7XG5cbiAgICBpZiAoc25hY2spIHtcbiAgICAgIGlmIChzbmFjay5vblJlbW92ZSkge1xuICAgICAgICBzbmFjay5vblJlbW92ZShzbmFjayk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9uUmVtb3ZlKSB7XG4gICAgICAgIHRoaXMub25SZW1vdmUuZW1pdChzbmFjayk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzbmFjay50aW1lb3V0T2JqKSB7XG4gICAgICAgIGNsZWFyVGltZW91dChzbmFjay50aW1lb3V0T2JqKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnNuYWNrcyA9IHRoaXMuc25hY2tzLmZpbHRlcihvYmogPT4gb2JqLmlkICE9PSBpZCk7XG4gIH1cblxuICBjbGVhcigpIHtcbiAgICAvLyB0aGlzLnNuYWNrcy5mb3JFYWNoKHNuYWNrID0+IHtcbiAgICAvLyAgIHRoaXMucmVtb3ZlKHNuYWNrLmlkKTtcbiAgICAvLyB9KTtcblxuICAgIHRoaXMuc25hY2tzID0gW107XG5cbiAgICBpZiAodGhpcy5vbkNsZWFyKSB7XG4gICAgICB0aGlzLm9uQ2xlYXIuZW1pdCh0cnVlKTtcbiAgICB9XG4gIH1cblxuICB1dWlkKCkge1xuICAgIC8vIHRzbGludDpkaXNhYmxlOm5vLWJpdHdpc2VcbiAgICByZXR1cm4gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykge1xuICAgICAgY29uc3QgciA9IE1hdGgucmFuZG9tKCkgKiAxNiB8IDAsIHYgPSBjID09PSAneCcgPyByIDogKHIgJiAweDMgfCAweDgpO1xuICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICAgIH0pO1xuICAgIC8vIHRzbGludDplbmFibGU6bm8tYml0d2lzZVxuICB9XG5cbiAgY2FsY1RleHRDb2xvcihiYWNrZ3JvdW5kKSB7XG4gICAgaWYgKCFiYWNrZ3JvdW5kKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoZXhUb1JnYihoZXgpIHtcbiAgICAgIGNvbnN0IHNob3J0aGFuZFJlZ2V4ID0gL14jPyhbYS1mXFxkXSkoW2EtZlxcZF0pKFthLWZcXGRdKSQvaTtcbiAgICAgIGhleCA9IGhleC5yZXBsYWNlKHNob3J0aGFuZFJlZ2V4LCAobSwgciwgZywgYikgPT4ge1xuICAgICAgICByZXR1cm4gciArIHIgKyBnICsgZyArIGIgKyBiO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IC9eIz8oW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkkL2kuZXhlYyhoZXgpO1xuICAgICAgcmV0dXJuIHJlc3VsdCA/IHtcbiAgICAgICAgcjogcGFyc2VJbnQocmVzdWx0WzFdLCAxNiksXG4gICAgICAgIGc6IHBhcnNlSW50KHJlc3VsdFsyXSwgMTYpLFxuICAgICAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KVxuICAgICAgfSA6IG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgcmdiID0gaGV4VG9SZ2IoYmFja2dyb3VuZCk7XG4gICAgaWYgKCFyZ2IpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbG9yID0gW3JnYi5yIC8gMjU1LCByZ2IuZyAvIDI1NSwgcmdiLmIgLyAyNTVdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xvci5sZW5ndGg7ICsraSkge1xuICAgICAgaWYgKGNvbG9yW2ldIDw9IDAuMDM5MjgpIHtcbiAgICAgICAgY29sb3JbaV0gPSBjb2xvcltpXSAvIDEyLjkyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29sb3JbaV0gPSBNYXRoLnBvdygoY29sb3JbaV0gKyAwLjA1NSkgLyAxLjA1NSwgMi40KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBsID0gMC4yMTI2ICogY29sb3JbMF0gKyAwLjcxNTIgKiBjb2xvclsxXSArIDAuMDcyMiAqIGNvbG9yWzJdO1xuXG4gICAgaWYgKGwgPiAwLjE3OSkge1xuICAgICAgcmV0dXJuICcjMDAwJztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICcjZmZmJztcbiAgICB9XG4gIH1cbn1cbiJdfQ==