import * as tslib_1 from "tslib";
/*DEFAULT GENERATED TEMPLATE. DO NOT CHANGE SELECTOR TEMPLATE_URL AND CLASS NAME*/
import { Component, ViewChild, Input, Output, EventEmitter } from '@angular/core';
import * as signing from 'signature_pad';
// import { MatSnackBar } from '@angular/material';
/**
* Model import Example :
* import { HERO } from '../models/hero.model';
*/
/**
 * Service import Example :
 * import { HeroService } from '../services/hero/hero.service';
 */
var NSignatureComponent = /** @class */ (function () {
    function NSignatureComponent() {
        this.imageDataValue = '';
        this.signaturePad = '';
        this.mode = 'responsive'; // 'click-fullscreen' or 'responsive'
        this.canvasMode = 'responsive'; // 'responsive' or 'fullscreen'
        this.imageDataChange = new EventEmitter();
    }
    Object.defineProperty(NSignatureComponent.prototype, "imageData", {
        get: function () {
            return this.imageDataValue;
        },
        set: function (val) {
            this.imageDataValue = val;
            if (val || val === '' || this.isDataURL(val)) {
                this.saveCavas(val);
            }
            this.imageDataChange.emit(this.imageDataValue);
        },
        enumerable: true,
        configurable: true
    });
    NSignatureComponent.prototype.ngAfterViewInit = function () {
        if (this.mode === 'responsive') {
            this.createCanvas();
        }
    };
    NSignatureComponent.prototype.createCanvas = function () {
        this.fitToContainer(this.signaturecanvas.nativeElement);
        this.signaturePad = new signing.default(this.signaturecanvas.nativeElement, this.assignOptions());
    };
    NSignatureComponent.prototype.saveCavas = function (dataUrl) {
        if (this.signaturePad) {
            if (this.signaturePad.isEmpty() || dataUrl === '') {
                this.savedData = '';
                this.signaturePad.clear();
            }
            else if (this.isDataURL(dataUrl)) {
                this.signaturePad.fromDataURL(dataUrl);
                this.savedData = this.signaturePad.toData();
            }
            else {
                this.imageData = this.signaturePad.toDataURL();
                if (this.mode === 'click-fullscreen') {
                    this.savedData = this.signaturePad.toData();
                    this.hideCanvas();
                }
            }
        }
    };
    NSignatureComponent.prototype.clearCanvas = function () {
        this.signaturePad.clear();
        // this.fitToContainer(this.signaturecanvas.nativeElement);
    };
    NSignatureComponent.prototype.undoCanvas = function () {
        var data = this.signaturePad.toData();
        if (data) {
            data.pop(); // remove the last dot or line
            this.signaturePad.fromData(data);
        }
    };
    NSignatureComponent.prototype.showCanvas = function () {
        this.classAbs = true;
        this.canvasMode = 'fullscreen';
        if (!this.signaturePad) {
            this.createCanvas();
        }
        this.fitToContainer(this.signaturecanvas.nativeElement, document.body.clientHeight, document.body.clientWidth);
        this.clearCanvas();
        this.createCanvasFromData();
    };
    NSignatureComponent.prototype.hideCanvas = function () {
        this.canvasMode = 'responsive';
    };
    // cancel currently drawn
    NSignatureComponent.prototype.cancel = function () {
        this.savedData = Object.assign([], this.previousSavedData);
    };
    NSignatureComponent.prototype.createCanvasFromData = function () {
        if (this.savedData) {
            this.previousSavedData = Object.assign({}, this.savedData);
            this.signaturePad.fromData(this.savedData);
        }
    };
    NSignatureComponent.prototype.fitToContainer = function (element, height, width) {
        element.style.width = '100%';
        element.style.height = 'calc(100% - 56px)';
        if (height && width) {
            element.width = width;
            element.height = height - 56;
        }
        else {
            element.width = element.offsetWidth;
            element.height = element.offsetHeight;
        }
    };
    NSignatureComponent.prototype.assignOptions = function () {
        var options = {};
        options['backgroundColor'] = this.checkIfValidValueAndRGB(this.backgroundColor, 'backgroundColor');
        options['dotSize'] = this.checkIfValidValueAndNumber(this.dotSize, 'dotSize');
        options['minWidth'] = this.checkIfValidValueAndNumber(this.minWidth, 'minWidth');
        options['maxWidth'] = this.checkIfValidValueAndNumber(this.maxWidth, 'maxWidth');
        options['throttle'] = this.checkIfValidValueAndNumber(this.throttle, 'throttle');
        options['minDistance'] = this.checkIfValidValueAndNumber(this.minDistance, 'minDistance');
        options['penColor'] = this.checkIfValidValueAndRGB(this.penColor, 'penColor');
        options['velocityFilterWeight'] = this.checkIfValidValueAndNumber(this.velocityFilterWeight, 'velocityFilterWeight');
        options = JSON.parse(JSON.stringify(options)); // removing all undefined fields
        options['onBegin'] = this.checkIfValidValueAndFunction(this.onBegin, 'onBegin');
        options['onEnd'] = this.checkIfValidValueAndFunction(this.onEnd, 'onEnd');
        return options;
    };
    NSignatureComponent.prototype.checkIfValidValueAndNumber = function (num, name) {
        if (this.checkIfValid(num) && this.checkNumber(num)) {
            return num;
        }
        this.invalidToast(name, 'num');
        return undefined;
    };
    NSignatureComponent.prototype.checkIfValidValueAndRGB = function (color, name) {
        if (this.checkIfValid(color) && this.checkRGB(color)) {
            return color;
        }
        this.invalidToast(name, 'rgb');
        return undefined;
    };
    NSignatureComponent.prototype.checkIfValidValueAndFunction = function (fn, name) {
        if (this.checkIfValid(fn) && this.checkIfValidFunction(fn)) {
            return fn;
        }
        this.invalidToast(name, 'function format');
        return undefined;
    };
    NSignatureComponent.prototype.checkIfValid = function (value) {
        return (value !== undefined && value !== null) ? value : undefined;
    };
    NSignatureComponent.prototype.checkNumber = function (num) {
        return !this.checkIsNan(Number(num)) ? Number(num) : undefined;
    };
    NSignatureComponent.prototype.checkIfValidFunction = function (fn) {
        return typeof fn === 'function' ? fn : undefined;
    };
    NSignatureComponent.prototype.checkRGB = function (color) {
        var matchColors1 = new RegExp(/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/);
        var matchColors2 = new RegExp(/rgb\((\d{1,3}),[ \t]+(\d{1,3}),(\d{1,3})\)/);
        var matchColors3 = new RegExp(/rgb\((\d{1,3}),(\d{1,3}),[ \t]+(\d{1,3})\)/);
        return matchColors1.test(color) || matchColors2.test(color) || matchColors3.test(color);
    };
    NSignatureComponent.prototype.checkIsNan = function (value) {
        return Number.isNaN(value);
    };
    NSignatureComponent.prototype.invalidToast = function (optionName, optionType) {
        switch (optionType) {
            case 'num':
                // this.snackbar.open(`Invalid ${optionName} (number or float) given, taking default value instead.`, 'OK');
                break;
            case 'rgb':
                // this.snackbar.open(`Invalid ${optionName} format Eg: rgb(255, 255, 255)  given, taking default value instead.`, 'OK');
                break;
        }
        return;
    };
    NSignatureComponent.prototype.isDataURL = function (s) {
        if (s) {
            var regex = /^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;
            return !!s.match(regex);
        }
        else {
            return false;
        }
    };
    tslib_1.__decorate([
        ViewChild('signaturecanvas', { static: false }),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "signaturecanvas", void 0);
    tslib_1.__decorate([
        ViewChild('canvasparent', { static: false }),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "canvasparent", void 0);
    tslib_1.__decorate([
        Input('backgroundColor'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "backgroundColor", void 0);
    tslib_1.__decorate([
        Input('dotSize'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "dotSize", void 0);
    tslib_1.__decorate([
        Input('minWidth'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "minWidth", void 0);
    tslib_1.__decorate([
        Input('maxWidth'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "maxWidth", void 0);
    tslib_1.__decorate([
        Input('throttle'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "throttle", void 0);
    tslib_1.__decorate([
        Input('minDistance'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "minDistance", void 0);
    tslib_1.__decorate([
        Input('penColor'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "penColor", void 0);
    tslib_1.__decorate([
        Input('velocityFilterWeight'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "velocityFilterWeight", void 0);
    tslib_1.__decorate([
        Input('onBegin'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "onBegin", void 0);
    tslib_1.__decorate([
        Input('onEnd'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "onEnd", void 0);
    tslib_1.__decorate([
        Input('mode'),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "mode", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NSignatureComponent.prototype, "imageDataChange", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], NSignatureComponent.prototype, "imageData", null);
    NSignatureComponent = tslib_1.__decorate([
        Component({
            selector: 'n-signature',
            template: "<div fxFill fxLayout=\"row\" *ngIf=\"mode == 'click-fullscreen' && canvasMode !== 'fullscreen'\" class=\"signature-component-border\">\n    <div fxFlex=\"calc(100%-56px)\" fxLayout=\"column\">\n        <img *ngIf=\"imageDataValue\" [src]=\"imageDataValue\" fxFill/>\n    </div>\n    <div fxFlex=\"56px\" fxLayoutAlign=\" center\" class=\"signature-component-border\">\n        <button mat-icon-button (click)=\"showCanvas()\">\n            <mat-icon>mode_edit</mat-icon>\n        </button>\n    </div>\n</div>\n<div fxFill fxLayout=\"column\" class=\"signature-component-border\" [fxShow]=\"(mode == 'click-fullscreen' && canvasMode == 'fullscreen') || mode == 'responsive'\" [ngClass]=\"{'signature-canvas-fullscreen': classAbs}\">\n    <canvas #signaturecanvas></canvas>\n    <div fxFlex=\"56px\" fxLayoutAlign=\"center center\" class=\"signature-component-border\">\n        <button mat-icon-button (click)=\"undoCanvas()\">\n            <mat-icon>undo</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"clearCanvas()\">\n            <mat-icon>loop</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"saveCavas()\">\n            <mat-icon>save</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"canvasMode = 'responsive'; cancel()\">\n            <mat-icon>clear</mat-icon>\n        </button>\n    </div>\n</div>",
            styles: ["\n     :host { height: 100% !important; }\n     .signature-canvas-fullscreen {\n         position: absolute;\n         top: 0;\n         bottom: 0;\n         right: 0;\n         left: 0;\n     }\n     .signature-component-border {\n         border: 2px solid black;\n     }\n    "]
        })
    ], NSignatureComponent);
    return NSignatureComponent;
}());
export { NSignatureComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibi1zaWduYXR1cmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmV1dHJpbm9zLW1vZHVsZS8iLCJzb3VyY2VzIjpbInNyYy9hcHAvbmV1dHJpbm9zLW1vZHVsZS9uZXV0cmlub3MtY29tcG9uZW50cy9uU2lnbmF0dXJlQ29tcG9uZW50L24tc2lnbmF0dXJlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsa0ZBQWtGO0FBQ2xGLE9BQU8sRUFBRSxTQUFTLEVBQWlCLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqRyxPQUFPLEtBQUssT0FBTyxNQUFNLGVBQWUsQ0FBQztBQUN6QyxtREFBbUQ7QUFDbkQ7OztFQUdFO0FBRUY7OztHQUdHO0FBb0JIO0lBbEJBO1FBb0JJLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FBQ1osaUJBQVksR0FBUSxFQUFFLENBQUM7UUFlaEIsU0FBSSxHQUFHLFlBQVksQ0FBQyxDQUFDLHFDQUFxQztRQUN6RSxlQUFVLEdBQUcsWUFBWSxDQUFDLENBQUMsK0JBQStCO1FBS2hELG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQXFMbkQsQ0FBQztJQW5MRyxzQkFBSSwwQ0FBUzthQUFiO1lBQ0ksT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQy9CLENBQUM7YUFFRCxVQUFjLEdBQUc7WUFDYixJQUFJLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQztZQUMxQixJQUFJLEdBQUcsSUFBSSxHQUFHLEtBQUssRUFBRSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQzFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDdkI7WUFDRCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDbkQsQ0FBQzs7O09BUkE7SUFVRCw2Q0FBZSxH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S0FBSyxDQUFDLFNBQVMsQ0FBQzs7d0RBQVM7SUFDUDtRQUFsQixLQUFLLENBQUMsVUFBVSxDQUFDOzt5REFBVTtJQUNUO1FBQWxCLEtBQUssQ0FBQyxVQUFVLENBQUM7O3lEQUFVO0lBQ1Q7UUFBbEIsS0FBSyxDQUFDLFVBQVUsQ0FBQzs7eURBQVU7SUFDTjtRQUFyQixLQUFLLENBQUMsYUFBYSxDQUFDOzs0REFBYTtJQUNmO1FBQWxCLEtBQUssQ0FBQyxVQUFVLENBQUM7O3lEQUFVO0lBQ0c7UUFBOUIsS0FBSyxDQUFDLHNCQUFzQixDQUFDOztxRUFBc0I7SUFDbEM7UUFBakIsS0FBSyxDQUFDLFNBQVMsQ0FBQzs7d0RBQVM7SUFDVjtRQUFmLEtBQUssQ0FBQyxPQUFPLENBQUM7O3NEQUFPO0lBQ1A7UUFBZCxLQUFLLENBQUMsTUFBTSxDQUFDOztxREFBcUI7SUFNekI7UUFBVCxNQUFNLEVBQUU7O2dFQUFzQztJQUUvQztRQURDLEtBQUssRUFBRTs7O3dEQUdQO0lBNUJRLG1CQUFtQjtRQWxCL0IsU0FBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLGFBQWE7WUFDdkIsZzNDQUEwQztxQkFDakMseVJBWVI7U0FDSixDQUFDO09BRVcsbUJBQW1CLENBNk0vQjtJQUFELDBCQUFDO0NBQUEsQUE3TUQsSUE2TUM7U0E3TVksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiLypERUZBVUxUIEdFTkVSQVRFRCBURU1QTEFURS4gRE8gTk9UIENIQU5HRSBTRUxFQ1RPUiBURU1QTEFURV9VUkwgQU5EIENMQVNTIE5BTUUqL1xuaW1wb3J0IHsgQ29tcG9uZW50LCBBZnRlclZpZXdJbml0LCBWaWV3Q2hpbGQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgc2lnbmluZyBmcm9tICdzaWduYXR1cmVfcGFkJztcbi8vIGltcG9ydCB7IE1hdFNuYWNrQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuLyoqXG4qIE1vZGVsIGltcG9ydCBFeGFtcGxlIDpcbiogaW1wb3J0IHsgSEVSTyB9IGZyb20gJy4uL21vZGVscy9oZXJvLm1vZGVsJztcbiovXG5cbi8qKlxuICogU2VydmljZSBpbXBvcnQgRXhhbXBsZSA6XG4gKiBpbXBvcnQgeyBIZXJvU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2hlcm8vaGVyby5zZXJ2aWNlJztcbiAqL1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ24tc2lnbmF0dXJlJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vbi1zaWduYXR1cmUudGVtcGxhdGUuaHRtbCcsXG4gICAgc3R5bGVzOiBbYFxuICAgICA6aG9zdCB7IGhlaWdodDogMTAwJSAhaW1wb3J0YW50OyB9XG4gICAgIC5zaWduYXR1cmUtY2FudmFzLWZ1bGxzY3JlZW4ge1xuICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgdG9wOiAwO1xuICAgICAgICAgYm90dG9tOiAwO1xuICAgICAgICAgcmlnaHQ6IDA7XG4gICAgICAgICBsZWZ0OiAwO1xuICAgICB9XG4gICAgIC5zaWduYXR1cmUtY29tcG9uZW50LWJvcmRlciB7XG4gICAgICAgICBib3JkZXI6IDJweCBzb2xpZCBibGFjaztcbiAgICAgfVxuICAgIGBdXG59KVxuXG5leHBvcnQgY2xhc3MgTlNpZ25hdHVyZUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuXG4gICAgaW1hZ2VEYXRhVmFsdWUgPSAnJztcbiAgICBwcml2YXRlIHNpZ25hdHVyZVBhZDogYW55ID0gJyc7XG5cbiAgICBAVmlld0NoaWxkKCdzaWduYXR1cmVjYW52YXMnLCB7c3RhdGljOiBmYWxzZX0pIHNpZ25hdHVyZWNhbnZhcztcbiAgICBAVmlld0NoaWxkKCdjYW52YXNwYXJlbnQnLCB7c3RhdGljOiBmYWxzZX0pIGNhbnZhc3BhcmVudDtcblxuICAgIEBJbnB1dCgnYmFja2dyb3VuZENvbG9yJykgYmFja2dyb3VuZENvbG9yO1xuICAgIEBJbnB1dCgnZG90U2l6ZScpIGRvdFNpemU7IC8vIChmbG9hdCBvciBmdW5jdGlvbikgUmFkaXVzIG9mIGEgc2luZ2xlIGRvdC5cbiAgICBASW5wdXQoJ21pbldpZHRoJykgbWluV2lkdGg7IC8vIChmbG9hdCkgTWluaW11bSB3aWR0aCBvZiBhIGxpbmUuIERlZmF1bHRzIHRvIDAuNS5cbiAgICBASW5wdXQoJ21heFdpZHRoJykgbWF4V2lkdGg7IC8vIChmbG9hdCkgTWF4aW11bSB3aWR0aCBvZiBhIGxpbmUuIERlZmF1bHRzIHRvIDIuNS5cbiAgICBASW5wdXQoJ3Rocm90dGxlJykgdGhyb3R0bGU7IC8vIChpbnRlZ2VyKSBEcmF3IHRoZSBuZXh0IHBvaW50IGF0IG1vc3Qgb25jZSBwZXIgZXZlcnkgeCBtaWxsaXNlY29uZHMuIFNldCBpdCB0byAwIHRvIHR1cm4gb2ZmIHRocm90dGxpbmcuIERlZmF1bHRzIHRvIDE2LlxuICAgIEBJbnB1dCgnbWluRGlzdGFuY2UnKSBtaW5EaXN0YW5jZTsgLy8gKGludGVnZXIpIEFkZCB0aGUgbmV4dCBwb2ludCBvbmx5IGlmIHRoZSBwcmV2aW91cyBvbmUgaXMgZmFydGhlciB0aGFuIHggcGl4ZWxzLiBEZWZhdWx0cyB0byA1LiBcbiAgICBASW5wdXQoJ3BlbkNvbG9yJykgcGVuQ29sb3I7IC8vIChzdHJpbmcpIENvbG9yIHVzZWQgdG8gY2xlYXIgdGhlIGJhY2tncm91bmQuIENhbiBiZSBhbnkgY29sb3IgZm9ybWF0IGFjY2VwdGVkIGJ5IGNvbnRleHQuZmlsbFN0eWxlLiBEZWZhdWx0cyB0byBcInJnYmEoMCwwLDAsMClcIiAodHJhbnNwYXJlbnQgYmxhY2spLiBVc2UgYSBub24tdHJhbnNwYXJlbnQgY29sb3IgZS5nLiBcInJnYigyNTUsMjU1LDI1NSlcIiAob3BhcXVlIHdoaXRlKSBpZiB5b3UnZCBsaWtlIHRvIHNhdmUgc2lnbmF0dXJlcyBhcyBKUEVHIGltYWdlcy5cbiAgICBASW5wdXQoJ3ZlbG9jaXR5RmlsdGVyV2VpZ2h0JykgdmVsb2NpdHlGaWx0ZXJXZWlnaHQ7IC8vIChmbG9hdCkgV2VpZ2h0IHVzZWQgdG8gbW9kaWZ5IG5ldyB2ZWxvY2l0eSBiYXNlZCBvbiB0aGUgcHJldmlvdXMgdmVsb2NpdHkuIERlZmF1bHRzIHRvIDAuNy5cbiAgICBASW5wdXQoJ29uQmVnaW4nKSBvbkJlZ2luOyAvLyAoZnVuY3Rpb24pIENhbGxiYWNrIHdoZW4gc3Ryb2tlIGJlZ2luLlxuICAgIEBJbnB1dCgnb25FbmQnKSBvbkVuZDsgLy8gKGZ1bmN0aW9uKSBDYWxsYmFjayB3aGVuIHN0cm9rZSBlbmQuXG4gICAgQElucHV0KCdtb2RlJykgbW9kZSA9ICdyZXNwb25zaXZlJzsgLy8gJ2NsaWNrLWZ1bGxzY3JlZW4nIG9yICdyZXNwb25zaXZlJ1xuICAgIGNhbnZhc01vZGUgPSAncmVzcG9uc2l2ZSc7IC8vICdyZXNwb25zaXZlJyBvciAnZnVsbHNjcmVlbidcbiAgICBwcml2YXRlIHNhdmVkRGF0YTtcbiAgICBwcml2YXRlIHByZXZpb3VzU2F2ZWREYXRhO1xuICAgIGNsYXNzQWJzO1xuXG4gICAgQE91dHB1dCgpIGltYWdlRGF0YUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBASW5wdXQoKVxuICAgIGdldCBpbWFnZURhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmltYWdlRGF0YVZhbHVlO1xuICAgIH1cblxuICAgIHNldCBpbWFnZURhdGEodmFsKSB7XG4gICAgICAgIHRoaXMuaW1hZ2VEYXRhVmFsdWUgPSB2YWw7XG4gICAgICAgIGlmICh2YWwgfHwgdmFsID09PSAnJyB8fCB0aGlzLmlzRGF0YVVSTCh2YWwpKSB7XG4gICAgICAgICAgICB0aGlzLnNhdmVDYXZhcyh2YWwpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW1hZ2VEYXRhQ2hhbmdlLmVtaXQodGhpcy5pbWFnZURhdGFWYWx1ZSk7XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICBpZiAodGhpcy5tb2RlID09PSAncmVzcG9uc2l2ZScpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2FudmFzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjcmVhdGVDYW52YXMoKSB7XG4gICAgICAgIHRoaXMuZml0VG9Db250YWluZXIodGhpcy5zaWduYXR1cmVjYW52YXMubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIHRoaXMuc2lnbmF0dXJlUGFkID0gbmV3IHNpZ25pbmcuZGVmYXVsdCh0aGlzLnNpZ25hdHVyZWNhbnZhcy5uYXRpdmVFbGVtZW50LCB0aGlzLmFzc2lnbk9wdGlvbnMoKSk7XG4gICAgfVxuXG4gICAgc2F2ZUNhdmFzKGRhdGFVcmw/KSB7XG4gICAgICAgIGlmICh0aGlzLnNpZ25hdHVyZVBhZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2lnbmF0dXJlUGFkLmlzRW1wdHkoKSB8fCBkYXRhVXJsID09PSAnJykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWREYXRhID0gJyc7XG4gICAgICAgICAgICAgICAgdGhpcy5zaWduYXR1cmVQYWQuY2xlYXIoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0RhdGFVUkwoZGF0YVVybCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5mcm9tRGF0YVVSTChkYXRhVXJsKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVkRGF0YSA9IHRoaXMuc2lnbmF0dXJlUGFkLnRvRGF0YSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlRGF0YSA9IHRoaXMuc2lnbmF0dXJlUGFkLnRvRGF0YVVSTCgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdjbGljay1mdWxsc2NyZWVuJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVkRGF0YSA9IHRoaXMuc2lnbmF0dXJlUGFkLnRvRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGVDYW52YXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbGVhckNhbnZhcygpIHtcbiAgICAgICAgdGhpcy5zaWduYXR1cmVQYWQuY2xlYXIoKTtcbiAgICAgICAgLy8gdGhpcy5maXRUb0NvbnRhaW5lcih0aGlzLnNpZ25hdHVyZWNhbnZhcy5uYXRpdmVFbGVtZW50KTtcbiAgICB9XG5cbiAgICB1bmRvQ2FudmFzKCkge1xuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5zaWduYXR1cmVQYWQudG9EYXRhKCk7XG5cbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIGRhdGEucG9wKCk7IC8vIHJlbW92ZSB0aGUgbGFzdCBkb3Qgb3IgbGluZVxuICAgICAgICAgICAgdGhpcy5zaWduYXR1cmVQYWQuZnJvbURhdGEoZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzaG93Q2FudmFzKCkge1xuICAgICAgICB0aGlzLmNsYXNzQWJzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jYW52YXNNb2RlID0gJ2Z1bGxzY3JlZW4nO1xuICAgICAgICBpZiAoIXRoaXMuc2lnbmF0dXJlUGFkKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUNhbnZhcygpO1xuXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maXRUb0NvbnRhaW5lcih0aGlzLnNpZ25hdHVyZWNhbnZhcy5uYXRpdmVFbGVtZW50LCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aClcbiAgICAgICAgdGhpcy5jbGVhckNhbnZhcygpO1xuICAgICAgICB0aGlzLmNyZWF0ZUNhbnZhc0Zyb21EYXRhKCk7XG4gICAgfVxuXG4gICAgaGlkZUNhbnZhcygpIHtcbiAgICAgICAgdGhpcy5jYW52YXNNb2RlID0gJ3Jlc3BvbnNpdmUnO1xuICAgIH1cblxuICAgIC8vIGNhbmNlbCBjdXJyZW50bHkgZHJhd25cbiAgICBjYW5jZWwoKSB7XG4gICAgICAgIHRoaXMuc2F2ZWREYXRhID0gT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5wcmV2aW91c1NhdmVkRGF0YSk7XG4gICAgfVxuXG4gICAgY3JlYXRlQ2FudmFzRnJvbURhdGEoKSB7XG4gICAgICAgIGlmICh0aGlzLnNhdmVkRGF0YSkge1xuICAgICAgICAgICAgdGhpcy5wcmV2aW91c1NhdmVkRGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc2F2ZWREYXRhKTtcbiAgICAgICAgICAgIHRoaXMuc2lnbmF0dXJlUGFkLmZyb21EYXRhKHRoaXMuc2F2ZWREYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZml0VG9Db250YWluZXIoZWxlbWVudCwgaGVpZ2h0Pywgd2lkdGg/KSB7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSAnMTAwJSc7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJ2NhbGMoMTAwJSAtIDU2cHgpJztcbiAgICAgICAgaWYgKGhlaWdodCAmJiB3aWR0aCkge1xuICAgICAgICAgICAgZWxlbWVudC53aWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgZWxlbWVudC5oZWlnaHQgPSBoZWlnaHQgLSA1NjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVsZW1lbnQud2lkdGggPSBlbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgICAgICAgZWxlbWVudC5oZWlnaHQgPSBlbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3NpZ25PcHRpb25zKCkge1xuICAgICAgICBsZXQgb3B0aW9ucyA9IHt9O1xuICAgICAgICBvcHRpb25zWydiYWNrZ3JvdW5kQ29sb3InXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmRSR0IodGhpcy5iYWNrZ3JvdW5kQ29sb3IsICdiYWNrZ3JvdW5kQ29sb3InKVxuICAgICAgICBvcHRpb25zWydkb3RTaXplJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMuZG90U2l6ZSwgJ2RvdFNpemUnKTtcbiAgICAgICAgb3B0aW9uc1snbWluV2lkdGgnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIodGhpcy5taW5XaWR0aCwgJ21pbldpZHRoJyk7XG4gICAgICAgIG9wdGlvbnNbJ21heFdpZHRoJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMubWF4V2lkdGgsICdtYXhXaWR0aCcpO1xuICAgICAgICBvcHRpb25zWyd0aHJvdHRsZSddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZE51bWJlcih0aGlzLnRocm90dGxlLCAndGhyb3R0bGUnKTtcbiAgICAgICAgb3B0aW9uc1snbWluRGlzdGFuY2UnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIodGhpcy5taW5EaXN0YW5jZSwgJ21pbkRpc3RhbmNlJyk7XG4gICAgICAgIG9wdGlvbnNbJ3BlbkNvbG9yJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kUkdCKHRoaXMucGVuQ29sb3IsICdwZW5Db2xvcicpXG4gICAgICAgIG9wdGlvbnNbJ3ZlbG9jaXR5RmlsdGVyV2VpZ2h0J10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMudmVsb2NpdHlGaWx0ZXJXZWlnaHQsICd2ZWxvY2l0eUZpbHRlcldlaWdodCcpO1xuICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvcHRpb25zKSk7IC8vIHJlbW92aW5nIGFsbCB1bmRlZmluZWQgZmllbGRzXG4gICAgICAgIG9wdGlvbnNbJ29uQmVnaW4nXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmRGdW5jdGlvbih0aGlzLm9uQmVnaW4sICdvbkJlZ2luJyk7XG4gICAgICAgIG9wdGlvbnNbJ29uRW5kJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kRnVuY3Rpb24odGhpcy5vbkVuZCwgJ29uRW5kJyk7XG4gICAgICAgIHJldHVybiBvcHRpb25zO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIobnVtLCBuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrSWZWYWxpZChudW0pICYmIHRoaXMuY2hlY2tOdW1iZXIobnVtKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmludmFsaWRUb2FzdChuYW1lLCAnbnVtJyk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0lmVmFsaWRWYWx1ZUFuZFJHQihjb2xvciwgbmFtZSkge1xuICAgICAgICBpZiAodGhpcy5jaGVja0lmVmFsaWQoY29sb3IpICYmIHRoaXMuY2hlY2tSR0IoY29sb3IpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbnZhbGlkVG9hc3QobmFtZSwgJ3JnYicpO1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tJZlZhbGlkVmFsdWVBbmRGdW5jdGlvbihmbiwgbmFtZSkge1xuICAgICAgICBpZiAodGhpcy5jaGVja0lmVmFsaWQoZm4pICYmIHRoaXMuY2hlY2tJZlZhbGlkRnVuY3Rpb24oZm4pKSB7XG4gICAgICAgICAgICByZXR1cm4gZm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbnZhbGlkVG9hc3QobmFtZSwgJ2Z1bmN0aW9uIGZvcm1hdCcpO1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tJZlZhbGlkKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrTnVtYmVyKG51bSkge1xuICAgICAgICByZXR1cm4gIXRoaXMuY2hlY2tJc05hbihOdW1iZXIobnVtKSkgPyBOdW1iZXIobnVtKSA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrSWZWYWxpZEZ1bmN0aW9uKGZuKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicgPyBmbiA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrUkdCKGNvbG9yKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoQ29sb3JzMSA9IG5ldyBSZWdFeHAoL3JnYlxcKChcXGR7MSwzfSksKFxcZHsxLDN9KSwoXFxkezEsM30pXFwpLyk7XG4gICAgICAgIGNvbnN0IG1hdGNoQ29sb3JzMiA9IG5ldyBSZWdFeHAoL3JnYlxcKChcXGR7MSwzfSksWyBcXHRdKyhcXGR7MSwzfSksKFxcZHsxLDN9KVxcKS8pO1xuICAgICAgICBjb25zdCBtYXRjaENvbG9yczMgPSBuZXcgUmVnRXhwKC9yZ2JcXCgoXFxkezEsM30pLChcXGR7MSwzfSksWyBcXHRdKyhcXGR7MSwzfSlcXCkvKVxuICAgICAgICByZXR1cm4gbWF0Y2hDb2xvcnMxLnRlc3QoY29sb3IpIHx8IG1hdGNoQ29sb3JzMi50ZXN0KGNvbG9yKSB8fCBtYXRjaENvbG9yczMudGVzdChjb2xvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0lzTmFuKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBOdW1iZXIuaXNOYU4odmFsdWUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaW52YWxpZFRvYXN0KG9wdGlvbk5hbWUsIG9wdGlvblR5cGUpIHtcbiAgICAgICAgc3dpdGNoIChvcHRpb25UeXBlKSB7XG4gICAgICAgICAgICBjYXNlICdudW0nOlxuICAgICAgICAgICAgICAgIC8vIHRoaXMuc25hY2tiYXIub3BlbihgSW52YWxpZCAke29wdGlvbk5hbWV9IChudW1iZXIgb3IgZmxvYXQpIGdpdmVuLCB0YWtpbmcgZGVmYXVsdCB2YWx1ZSBpbnN0ZWFkLmAsICdPSycpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAncmdiJzpcbiAgICAgICAgICAgICAgICAvLyB0aGlzLnNuYWNrYmFyLm9wZW4oYEludmFsaWQgJHtvcHRpb25OYW1lfSBmb3JtYXQgRWc6IHJnYigyNTUsIDI1NSwgMjU1KSAgZ2l2ZW4sIHRha2luZyBkZWZhdWx0IHZhbHVlIGluc3RlYWQuYCwgJ09LJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNEYXRhVVJMKHMpIHtcbiAgICAgICAgaWYgKHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gL15cXHMqZGF0YTooW2Etel0rXFwvW2Etel0rKDtbYS16XFwtXStcXD1bYS16XFwtXSspPyk/KDtiYXNlNjQpPyxbYS16MC05XFwhXFwkXFwmXFwnXFwsXFwoXFwpXFwqXFwrXFwsXFw7XFw9XFwtXFwuXFxfXFx+XFw6XFxAXFwvXFw/XFwlXFxzXSpcXHMqJC9pO1xuICAgICAgICAgICAgcmV0dXJuICEhcy5tYXRjaChyZWdleCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=