import * as tslib_1 from "tslib";
/*DEFAULT GENERATED TEMPLATE. DO NOT CHANGE SELECTOR TEMPLATE_URL AND CLASS NAME*/
import { Component, ViewChild, Input, Output, EventEmitter } from '@angular/core';
import * as signing from 'signature_pad';
// import { MatSnackBar } from '@angular/material';
/**
* Model import Example :
* import { HERO } from '../models/hero.model';
*/
/**
 * Service import Example :
 * import { HeroService } from '../services/hero/hero.service';
 */
let NSignatureComponent = class NSignatureComponent {
    // import { MatSnackBar } from '@angular/material';
    /**
    * Model import Example :
    * import { HERO } from '../models/hero.model';
    */
    /**
     * Service import Example :
     * import { HeroService } from '../services/hero/hero.service';
     */
    constructor() {
        this.imageDataValue = '';
        this.signaturePad = '';
        this.mode = 'responsive'; // 'click-fullscreen' or 'responsive'
        this.canvasMode = 'responsive'; // 'responsive' or 'fullscreen'
        this.imageDataChange = new EventEmitter();
    }
    get imageData() {
        return this.imageDataValue;
    }
    set imageData(val) {
        this.imageDataValue = val;
        if (val || val === '' || this.isDataURL(val)) {
            this.saveCavas(val);
        }
        this.imageDataChange.emit(this.imageDataValue);
    }
    ngAfterViewInit() {
        if (this.mode === 'responsive') {
            this.createCanvas();
        }
    }
    createCanvas() {
        this.fitToContainer(this.signaturecanvas.nativeElement);
        this.signaturePad = new signing.default(this.signaturecanvas.nativeElement, this.assignOptions());
    }
    saveCavas(dataUrl) {
        if (this.signaturePad) {
            if (this.signaturePad.isEmpty() || dataUrl === '') {
                this.savedData = '';
                this.signaturePad.clear();
            }
            else if (this.isDataURL(dataUrl)) {
                this.signaturePad.fromDataURL(dataUrl);
                this.savedData = this.signaturePad.toData();
            }
            else {
                this.imageData = this.signaturePad.toDataURL();
                if (this.mode === 'click-fullscreen') {
                    this.savedData = this.signaturePad.toData();
                    this.hideCanvas();
                }
            }
        }
    }
    clearCanvas() {
        this.signaturePad.clear();
        // this.fitToContainer(this.signaturecanvas.nativeElement);
    }
    undoCanvas() {
        const data = this.signaturePad.toData();
        if (data) {
            data.pop(); // remove the last dot or line
            this.signaturePad.fromData(data);
        }
    }
    showCanvas() {
        this.classAbs = true;
        this.canvasMode = 'fullscreen';
        if (!this.signaturePad) {
            this.createCanvas();
        }
        this.fitToContainer(this.signaturecanvas.nativeElement, document.body.clientHeight, document.body.clientWidth);
        this.clearCanvas();
        this.createCanvasFromData();
    }
    hideCanvas() {
        this.canvasMode = 'responsive';
    }
    // cancel currently drawn
    cancel() {
        this.savedData = Object.assign([], this.previousSavedData);
    }
    createCanvasFromData() {
        if (this.savedData) {
            this.previousSavedData = Object.assign({}, this.savedData);
            this.signaturePad.fromData(this.savedData);
        }
    }
    fitToContainer(element, height, width) {
        element.style.width = '100%';
        element.style.height = 'calc(100% - 56px)';
        if (height && width) {
            element.width = width;
            element.height = height - 56;
        }
        else {
            element.width = element.offsetWidth;
            element.height = element.offsetHeight;
        }
    }
    assignOptions() {
        let options = {};
        options['backgroundColor'] = this.checkIfValidValueAndRGB(this.backgroundColor, 'backgroundColor');
        options['dotSize'] = this.checkIfValidValueAndNumber(this.dotSize, 'dotSize');
        options['minWidth'] = this.checkIfValidValueAndNumber(this.minWidth, 'minWidth');
        options['maxWidth'] = this.checkIfValidValueAndNumber(this.maxWidth, 'maxWidth');
        options['throttle'] = this.checkIfValidValueAndNumber(this.throttle, 'throttle');
        options['minDistance'] = this.checkIfValidValueAndNumber(this.minDistance, 'minDistance');
        options['penColor'] = this.checkIfValidValueAndRGB(this.penColor, 'penColor');
        options['velocityFilterWeight'] = this.checkIfValidValueAndNumber(this.velocityFilterWeight, 'velocityFilterWeight');
        options = JSON.parse(JSON.stringify(options)); // removing all undefined fields
        options['onBegin'] = this.checkIfValidValueAndFunction(this.onBegin, 'onBegin');
        options['onEnd'] = this.checkIfValidValueAndFunction(this.onEnd, 'onEnd');
        return options;
    }
    checkIfValidValueAndNumber(num, name) {
        if (this.checkIfValid(num) && this.checkNumber(num)) {
            return num;
        }
        this.invalidToast(name, 'num');
        return undefined;
    }
    checkIfValidValueAndRGB(color, name) {
        if (this.checkIfValid(color) && this.checkRGB(color)) {
            return color;
        }
        this.invalidToast(name, 'rgb');
        return undefined;
    }
    checkIfValidValueAndFunction(fn, name) {
        if (this.checkIfValid(fn) && this.checkIfValidFunction(fn)) {
            return fn;
        }
        this.invalidToast(name, 'function format');
        return undefined;
    }
    checkIfValid(value) {
        return (value !== undefined && value !== null) ? value : undefined;
    }
    checkNumber(num) {
        return !this.checkIsNan(Number(num)) ? Number(num) : undefined;
    }
    checkIfValidFunction(fn) {
        return typeof fn === 'function' ? fn : undefined;
    }
    checkRGB(color) {
        const matchColors1 = new RegExp(/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/);
        const matchColors2 = new RegExp(/rgb\((\d{1,3}),[ \t]+(\d{1,3}),(\d{1,3})\)/);
        const matchColors3 = new RegExp(/rgb\((\d{1,3}),(\d{1,3}),[ \t]+(\d{1,3})\)/);
        return matchColors1.test(color) || matchColors2.test(color) || matchColors3.test(color);
    }
    checkIsNan(value) {
        return Number.isNaN(value);
    }
    invalidToast(optionName, optionType) {
        switch (optionType) {
            case 'num':
                // this.snackbar.open(`Invalid ${optionName} (number or float) given, taking default value instead.`, 'OK');
                break;
            case 'rgb':
                // this.snackbar.open(`Invalid ${optionName} format Eg: rgb(255, 255, 255)  given, taking default value instead.`, 'OK');
                break;
        }
        return;
    }
    isDataURL(s) {
        if (s) {
            const regex = /^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;
            return !!s.match(regex);
        }
        else {
            return false;
        }
    }
};
tslib_1.__decorate([
    ViewChild('signaturecanvas', { static: false }),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "signaturecanvas", void 0);
tslib_1.__decorate([
    ViewChild('canvasparent', { static: false }),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "canvasparent", void 0);
tslib_1.__decorate([
    Input('backgroundColor'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "backgroundColor", void 0);
tslib_1.__decorate([
    Input('dotSize'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "dotSize", void 0);
tslib_1.__decorate([
    Input('minWidth'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "minWidth", void 0);
tslib_1.__decorate([
    Input('maxWidth'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "maxWidth", void 0);
tslib_1.__decorate([
    Input('throttle'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "throttle", void 0);
tslib_1.__decorate([
    Input('minDistance'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "minDistance", void 0);
tslib_1.__decorate([
    Input('penColor'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "penColor", void 0);
tslib_1.__decorate([
    Input('velocityFilterWeight'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "velocityFilterWeight", void 0);
tslib_1.__decorate([
    Input('onBegin'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "onBegin", void 0);
tslib_1.__decorate([
    Input('onEnd'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "onEnd", void 0);
tslib_1.__decorate([
    Input('mode'),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "mode", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], NSignatureComponent.prototype, "imageDataChange", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object),
    tslib_1.__metadata("design:paramtypes", [Object])
], NSignatureComponent.prototype, "imageData", null);
NSignatureComponent = tslib_1.__decorate([
    Component({
        selector: 'n-signature',
        template: "<div fxFill fxLayout=\"row\" *ngIf=\"mode == 'click-fullscreen' && canvasMode !== 'fullscreen'\" class=\"signature-component-border\">\n    <div fxFlex=\"calc(100%-56px)\" fxLayout=\"column\">\n        <img *ngIf=\"imageDataValue\" [src]=\"imageDataValue\" fxFill/>\n    </div>\n    <div fxFlex=\"56px\" fxLayoutAlign=\" center\" class=\"signature-component-border\">\n        <button mat-icon-button (click)=\"showCanvas()\">\n            <mat-icon>mode_edit</mat-icon>\n        </button>\n    </div>\n</div>\n<div fxFill fxLayout=\"column\" class=\"signature-component-border\" [fxShow]=\"(mode == 'click-fullscreen' && canvasMode == 'fullscreen') || mode == 'responsive'\" [ngClass]=\"{'signature-canvas-fullscreen': classAbs}\">\n    <canvas #signaturecanvas></canvas>\n    <div fxFlex=\"56px\" fxLayoutAlign=\"center center\" class=\"signature-component-border\">\n        <button mat-icon-button (click)=\"undoCanvas()\">\n            <mat-icon>undo</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"clearCanvas()\">\n            <mat-icon>loop</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"saveCavas()\">\n            <mat-icon>save</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"canvasMode = 'responsive'; cancel()\">\n            <mat-icon>clear</mat-icon>\n        </button>\n    </div>\n</div>",
        styles: [`
     :host { height: 100% !important; }
     .signature-canvas-fullscreen {
         position: absolute;
         top: 0;
         bottom: 0;
         right: 0;
         left: 0;
     }
     .signature-component-border {
         border: 2px solid black;
     }
    `]
    })
], NSignatureComponent);
export { NSignatureComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibi1zaWduYXR1cmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmV1dHJpbm9zLW1vZHVsZS8iLCJzb3VyY2VzIjpbInNyYy9hcHAvbmV1dHJpbm9zLW1vZHVsZS9uZXV0cmlub3MtY29tcG9uZW50cy9uU2lnbmF0dXJlQ29tcG9uZW50L24tc2lnbmF0dXJlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsa0ZBQWtGO0FBQ2xGLE9BQU8sRUFBRSxTQUFTLEVBQWlCLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqRyxPQUFPLEtBQUssT0FBTyxNQUFNLGVBQWUsQ0FBQztBQUN6QyxtREFBbUQ7QUFDbkQ7OztFQUdFO0FBRUY7OztHQUdHO0FBb0JILElBQWEsbUJBQW1CLEdBQWhDLE1BQWEsbUJBQW1CO0lBN0JoQyxtREFBbUQ7SUFDbkQ7OztNQUdFO0lBRUY7OztPQUdHO0lBRUg7UUFvQkksbUJBQWMsR0FBRyxFQUFFLENBQUM7UUFDWixpQkFBWSxHQUFRLEVBQUUsQ0FBQztRQWVoQixTQUFJLEdBQUcsWUFBWSxDQUFDLENBQUMscUNBQXFDO1FBQ3pFLGVBQVUsR0FBRyxZQUFZLENBQUMsQ0FBQywrQkFBK0I7UUFLaEQsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBcUxuRCxDQUFDO0lBbkxHLElBQUksU0FBUztRQUNULE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUMvQixDQUFDO0lBRUQsSUFBSSxTQUFTLENBQUMsR0FBRztRQUNiLElBQUksQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDO1FBQzFCLElBQUksR0FBRyxJQUFJLEdBQUcsS0FBSyxFQUFFLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUMxQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxDQUFDLGVBQWUs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SUFBbEIsS0FBSyxDQUFDLFVBQVUsQ0FBQzs7cURBQVU7QUFDVDtJQUFsQixLQUFLLENBQUMsVUFBVSxDQUFDOztxREFBVTtBQUNOO0lBQXJCLEtBQUssQ0FBQyxhQUFhLENBQUM7O3dEQUFhO0FBQ2Y7SUFBbEIsS0FBSyxDQUFDLFVBQVUsQ0FBQzs7cURBQVU7QUFDRztJQUE5QixLQUFLLENBQUMsc0JBQXNCLENBQUM7O2lFQUFzQjtBQUNsQztJQUFqQixLQUFLLENBQUMsU0FBUyxDQUFDOztvREFBUztBQUNWO0lBQWYsS0FBSyxDQUFDLE9BQU8sQ0FBQzs7a0RBQU87QUFDUDtJQUFkLEtBQUssQ0FBQyxNQUFNLENBQUM7O2lEQUFxQjtBQU16QjtJQUFULE1BQU0sRUFBRTs7NERBQXNDO0FBRS9DO0lBREMsS0FBSyxFQUFFOzs7b0RBR1A7QUE1QlEsbUJBQW1CO0lBbEIvQixTQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsYUFBYTtRQUN2QixnM0NBQTBDO2lCQUNqQzs7Ozs7Ozs7Ozs7O0tBWVI7S0FDSixDQUFDO0dBRVcsbUJBQW1CLENBNk0vQjtTQTdNWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKkRFRkFVTFQgR0VORVJBVEVEIFRFTVBMQVRFLiBETyBOT1QgQ0hBTkdFIFNFTEVDVE9SIFRFTVBMQVRFX1VSTCBBTkQgQ0xBU1MgTkFNRSovXG5pbXBvcnQgeyBDb21wb25lbnQsIEFmdGVyVmlld0luaXQsIFZpZXdDaGlsZCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBzaWduaW5nIGZyb20gJ3NpZ25hdHVyZV9wYWQnO1xuLy8gaW1wb3J0IHsgTWF0U25hY2tCYXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG4vKipcbiogTW9kZWwgaW1wb3J0IEV4YW1wbGUgOlxuKiBpbXBvcnQgeyBIRVJPIH0gZnJvbSAnLi4vbW9kZWxzL2hlcm8ubW9kZWwnO1xuKi9cblxuLyoqXG4gKiBTZXJ2aWNlIGltcG9ydCBFeGFtcGxlIDpcbiAqIGltcG9ydCB7IEhlcm9TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvaGVyby9oZXJvLnNlcnZpY2UnO1xuICovXG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbi1zaWduYXR1cmUnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9uLXNpZ25hdHVyZS50ZW1wbGF0ZS5odG1sJyxcbiAgICBzdHlsZXM6IFtgXG4gICAgIDpob3N0IHsgaGVpZ2h0OiAxMDAlICFpbXBvcnRhbnQ7IH1cbiAgICAgLnNpZ25hdHVyZS1jYW52YXMtZnVsbHNjcmVlbiB7XG4gICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICB0b3A6IDA7XG4gICAgICAgICBib3R0b206IDA7XG4gICAgICAgICByaWdodDogMDtcbiAgICAgICAgIGxlZnQ6IDA7XG4gICAgIH1cbiAgICAgLnNpZ25hdHVyZS1jb21wb25lbnQtYm9yZGVyIHtcbiAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkIGJsYWNrO1xuICAgICB9XG4gICAgYF1cbn0pXG5cbmV4cG9ydCBjbGFzcyBOU2lnbmF0dXJlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgICBpbWFnZURhdGFWYWx1ZSA9ICcnO1xuICAgIHByaXZhdGUgc2lnbmF0dXJlUGFkOiBhbnkgPSAnJztcblxuICAgIEBWaWV3Q2hpbGQoJ3NpZ25hdHVyZWNhbnZhcycsIHtzdGF0aWM6IGZhbHNlfSkgc2lnbmF0dXJlY2FudmFzO1xuICAgIEBWaWV3Q2hpbGQoJ2NhbnZhc3BhcmVudCcsIHtzdGF0aWM6IGZhbHNlfSkgY2FudmFzcGFyZW50O1xuXG4gICAgQElucHV0KCdiYWNrZ3JvdW5kQ29sb3InKSBiYWNrZ3JvdW5kQ29sb3I7XG4gICAgQElucHV0KCdkb3RTaXplJykgZG90U2l6ZTsgLy8gKGZsb2F0IG9yIGZ1bmN0aW9uKSBSYWRpdXMgb2YgYSBzaW5nbGUgZG90LlxuICAgIEBJbnB1dCgnbWluV2lkdGgnKSBtaW5XaWR0aDsgLy8gKGZsb2F0KSBNaW5pbXVtIHdpZHRoIG9mIGEgbGluZS4gRGVmYXVsdHMgdG8gMC41LlxuICAgIEBJbnB1dCgnbWF4V2lkdGgnKSBtYXhXaWR0aDsgLy8gKGZsb2F0KSBNYXhpbXVtIHdpZHRoIG9mIGEgbGluZS4gRGVmYXVsdHMgdG8gMi41LlxuICAgIEBJbnB1dCgndGhyb3R0bGUnKSB0aHJvdHRsZTsgLy8gKGludGVnZXIpIERyYXcgdGhlIG5leHQgcG9pbnQgYXQgbW9zdCBvbmNlIHBlciBldmVyeSB4IG1pbGxpc2Vjb25kcy4gU2V0IGl0IHRvIDAgdG8gdHVybiBvZmYgdGhyb3R0bGluZy4gRGVmYXVsdHMgdG8gMTYuXG4gICAgQElucHV0KCdtaW5EaXN0YW5jZScpIG1pbkRpc3RhbmNlOyAvLyAoaW50ZWdlcikgQWRkIHRoZSBuZXh0IHBvaW50IG9ubHkgaWYgdGhlIHByZXZpb3VzIG9uZSBpcyBmYXJ0aGVyIHRoYW4geCBwaXhlbHMuIERlZmF1bHRzIHRvIDUuIFxuICAgIEBJbnB1dCgncGVuQ29sb3InKSBwZW5Db2xvcjsgLy8gKHN0cmluZykgQ29sb3IgdXNlZCB0byBjbGVhciB0aGUgYmFja2dyb3VuZC4gQ2FuIGJlIGFueSBjb2xvciBmb3JtYXQgYWNjZXB0ZWQgYnkgY29udGV4dC5maWxsU3R5bGUuIERlZmF1bHRzIHRvIFwicmdiYSgwLDAsMCwwKVwiICh0cmFuc3BhcmVudCBibGFjaykuIFVzZSBhIG5vbi10cmFuc3BhcmVudCBjb2xvciBlLmcuIFwicmdiKDI1NSwyNTUsMjU1KVwiIChvcGFxdWUgd2hpdGUpIGlmIHlvdSdkIGxpa2UgdG8gc2F2ZSBzaWduYXR1cmVzIGFzIEpQRUcgaW1hZ2VzLlxuICAgIEBJbnB1dCgndmVsb2NpdHlGaWx0ZXJXZWlnaHQnKSB2ZWxvY2l0eUZpbHRlcldlaWdodDsgLy8gKGZsb2F0KSBXZWlnaHQgdXNlZCB0byBtb2RpZnkgbmV3IHZlbG9jaXR5IGJhc2VkIG9uIHRoZSBwcmV2aW91cyB2ZWxvY2l0eS4gRGVmYXVsdHMgdG8gMC43LlxuICAgIEBJbnB1dCgnb25CZWdpbicpIG9uQmVnaW47IC8vIChmdW5jdGlvbikgQ2FsbGJhY2sgd2hlbiBzdHJva2UgYmVnaW4uXG4gICAgQElucHV0KCdvbkVuZCcpIG9uRW5kOyAvLyAoZnVuY3Rpb24pIENhbGxiYWNrIHdoZW4gc3Ryb2tlIGVuZC5cbiAgICBASW5wdXQoJ21vZGUnKSBtb2RlID0gJ3Jlc3BvbnNpdmUnOyAvLyAnY2xpY2stZnVsbHNjcmVlbicgb3IgJ3Jlc3BvbnNpdmUnXG4gICAgY2FudmFzTW9kZSA9ICdyZXNwb25zaXZlJzsgLy8gJ3Jlc3BvbnNpdmUnIG9yICdmdWxsc2NyZWVuJ1xuICAgIHByaXZhdGUgc2F2ZWREYXRhO1xuICAgIHByaXZhdGUgcHJldmlvdXNTYXZlZERhdGE7XG4gICAgY2xhc3NBYnM7XG5cbiAgICBAT3V0cHV0KCkgaW1hZ2VEYXRhQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IGltYWdlRGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1hZ2VEYXRhVmFsdWU7XG4gICAgfVxuXG4gICAgc2V0IGltYWdlRGF0YSh2YWwpIHtcbiAgICAgICAgdGhpcy5pbWFnZURhdGFWYWx1ZSA9IHZhbDtcbiAgICAgICAgaWYgKHZhbCB8fCB2YWwgPT09ICcnIHx8IHRoaXMuaXNEYXRhVVJMKHZhbCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2F2ZUNhdmFzKHZhbCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbWFnZURhdGFDaGFuZ2UuZW1pdCh0aGlzLmltYWdlRGF0YVZhbHVlKTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdyZXNwb25zaXZlJykge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVDYW52YXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNyZWF0ZUNhbnZhcygpIHtcbiAgICAgICAgdGhpcy5maXRUb0NvbnRhaW5lcih0aGlzLnNpZ25hdHVyZWNhbnZhcy5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgdGhpcy5zaWduYXR1cmVQYWQgPSBuZXcgc2lnbmluZy5kZWZhdWx0KHRoaXMuc2lnbmF0dXJlY2FudmFzLm5hdGl2ZUVsZW1lbnQsIHRoaXMuYXNzaWduT3B0aW9ucygpKTtcbiAgICB9XG5cbiAgICBzYXZlQ2F2YXMoZGF0YVVybD8pIHtcbiAgICAgICAgaWYgKHRoaXMuc2lnbmF0dXJlUGFkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zaWduYXR1cmVQYWQuaXNFbXB0eSgpIHx8IGRhdGFVcmwgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlZERhdGEgPSAnJztcbiAgICAgICAgICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5jbGVhcigpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRGF0YVVSTChkYXRhVXJsKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2lnbmF0dXJlUGFkLmZyb21EYXRhVVJMKGRhdGFVcmwpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWREYXRhID0gdGhpcy5zaWduYXR1cmVQYWQudG9EYXRhKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VEYXRhID0gdGhpcy5zaWduYXR1cmVQYWQudG9EYXRhVVJMKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ2NsaWNrLWZ1bGxzY3JlZW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWREYXRhID0gdGhpcy5zaWduYXR1cmVQYWQudG9EYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZUNhbnZhcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsZWFyQ2FudmFzKCkge1xuICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5jbGVhcigpO1xuICAgICAgICAvLyB0aGlzLmZpdFRvQ29udGFpbmVyKHRoaXMuc2lnbmF0dXJlY2FudmFzLm5hdGl2ZUVsZW1lbnQpO1xuICAgIH1cblxuICAgIHVuZG9DYW52YXMoKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnNpZ25hdHVyZVBhZC50b0RhdGEoKTtcblxuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgZGF0YS5wb3AoKTsgLy8gcmVtb3ZlIHRoZSBsYXN0IGRvdCBvciBsaW5lXG4gICAgICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5mcm9tRGF0YShkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNob3dDYW52YXMoKSB7XG4gICAgICAgIHRoaXMuY2xhc3NBYnMgPSB0cnVlO1xuICAgICAgICB0aGlzLmNhbnZhc01vZGUgPSAnZnVsbHNjcmVlbic7XG4gICAgICAgIGlmICghdGhpcy5zaWduYXR1cmVQYWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2FudmFzKCk7XG5cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpdFRvQ29udGFpbmVyKHRoaXMuc2lnbmF0dXJlY2FudmFzLm5hdGl2ZUVsZW1lbnQsIGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0LCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoKVxuICAgICAgICB0aGlzLmNsZWFyQ2FudmFzKCk7XG4gICAgICAgIHRoaXMuY3JlYXRlQ2FudmFzRnJvbURhdGEoKTtcbiAgICB9XG5cbiAgICBoaWRlQ2FudmFzKCkge1xuICAgICAgICB0aGlzLmNhbnZhc01vZGUgPSAncmVzcG9uc2l2ZSc7XG4gICAgfVxuXG4gICAgLy8gY2FuY2VsIGN1cnJlbnRseSBkcmF3blxuICAgIGNhbmNlbCgpIHtcbiAgICAgICAgdGhpcy5zYXZlZERhdGEgPSBPYmplY3QuYXNzaWduKFtdLCB0aGlzLnByZXZpb3VzU2F2ZWREYXRhKTtcbiAgICB9XG5cbiAgICBjcmVhdGVDYW52YXNGcm9tRGF0YSgpIHtcbiAgICAgICAgaWYgKHRoaXMuc2F2ZWREYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnByZXZpb3VzU2F2ZWREYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zYXZlZERhdGEpO1xuICAgICAgICAgICAgdGhpcy5zaWduYXR1cmVQYWQuZnJvbURhdGEodGhpcy5zYXZlZERhdGEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaXRUb0NvbnRhaW5lcihlbGVtZW50LCBoZWlnaHQ/LCB3aWR0aD8pIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS53aWR0aCA9ICcxMDAlJztcbiAgICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnY2FsYygxMDAlIC0gNTZweCknO1xuICAgICAgICBpZiAoaGVpZ2h0ICYmIHdpZHRoKSB7XG4gICAgICAgICAgICBlbGVtZW50LndpZHRoID0gd2lkdGg7XG4gICAgICAgICAgICBlbGVtZW50LmhlaWdodCA9IGhlaWdodCAtIDU2O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC53aWR0aCA9IGVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgICAgICBlbGVtZW50LmhlaWdodCA9IGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzc2lnbk9wdGlvbnMoKSB7XG4gICAgICAgIGxldCBvcHRpb25zID0ge307XG4gICAgICAgIG9wdGlvbnNbJ2JhY2tncm91bmRDb2xvciddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZFJHQih0aGlzLmJhY2tncm91bmRDb2xvciwgJ2JhY2tncm91bmRDb2xvcicpXG4gICAgICAgIG9wdGlvbnNbJ2RvdFNpemUnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIodGhpcy5kb3RTaXplLCAnZG90U2l6ZScpO1xuICAgICAgICBvcHRpb25zWydtaW5XaWR0aCddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZE51bWJlcih0aGlzLm1pbldpZHRoLCAnbWluV2lkdGgnKTtcbiAgICAgICAgb3B0aW9uc1snbWF4V2lkdGgnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIodGhpcy5tYXhXaWR0aCwgJ21heFdpZHRoJyk7XG4gICAgICAgIG9wdGlvbnNbJ3Rocm90dGxlJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMudGhyb3R0bGUsICd0aHJvdHRsZScpO1xuICAgICAgICBvcHRpb25zWydtaW5EaXN0YW5jZSddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZE51bWJlcih0aGlzLm1pbkRpc3RhbmNlLCAnbWluRGlzdGFuY2UnKTtcbiAgICAgICAgb3B0aW9uc1sncGVuQ29sb3InXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmRSR0IodGhpcy5wZW5Db2xvciwgJ3BlbkNvbG9yJylcbiAgICAgICAgb3B0aW9uc1sndmVsb2NpdHlGaWx0ZXJXZWlnaHQnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIodGhpcy52ZWxvY2l0eUZpbHRlcldlaWdodCwgJ3ZlbG9jaXR5RmlsdGVyV2VpZ2h0Jyk7XG4gICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpKTsgLy8gcmVtb3ZpbmcgYWxsIHVuZGVmaW5lZCBmaWVsZHNcbiAgICAgICAgb3B0aW9uc1snb25CZWdpbiddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZEZ1bmN0aW9uKHRoaXMub25CZWdpbiwgJ29uQmVnaW4nKTtcbiAgICAgICAgb3B0aW9uc1snb25FbmQnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmRGdW5jdGlvbih0aGlzLm9uRW5kLCAnb25FbmQnKTtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0lmVmFsaWRWYWx1ZUFuZE51bWJlcihudW0sIG5hbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tJZlZhbGlkKG51bSkgJiYgdGhpcy5jaGVja051bWJlcihudW0pKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVtO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW52YWxpZFRvYXN0KG5hbWUsICdudW0nKTtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrSWZWYWxpZFZhbHVlQW5kUkdCKGNvbG9yLCBuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrSWZWYWxpZChjb2xvcikgJiYgdGhpcy5jaGVja1JHQihjb2xvcikpIHtcbiAgICAgICAgICAgIHJldHVybiBjb2xvcjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmludmFsaWRUb2FzdChuYW1lLCAncmdiJyk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0lmVmFsaWRWYWx1ZUFuZEZ1bmN0aW9uKGZuLCBuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrSWZWYWxpZChmbikgJiYgdGhpcy5jaGVja0lmVmFsaWRGdW5jdGlvbihmbikpIHtcbiAgICAgICAgICAgIHJldHVybiBmbjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmludmFsaWRUb2FzdChuYW1lLCAnZnVuY3Rpb24gZm9ybWF0Jyk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0lmVmFsaWQodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsKSA/IHZhbHVlIDogdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tOdW1iZXIobnVtKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5jaGVja0lzTmFuKE51bWJlcihudW0pKSA/IE51bWJlcihudW0pIDogdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tJZlZhbGlkRnVuY3Rpb24oZm4pIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJyA/IGZuIDogdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tSR0IoY29sb3IpIHtcbiAgICAgICAgY29uc3QgbWF0Y2hDb2xvcnMxID0gbmV3IFJlZ0V4cCgvcmdiXFwoKFxcZHsxLDN9KSwoXFxkezEsM30pLChcXGR7MSwzfSlcXCkvKTtcbiAgICAgICAgY29uc3QgbWF0Y2hDb2xvcnMyID0gbmV3IFJlZ0V4cCgvcmdiXFwoKFxcZHsxLDN9KSxbIFxcdF0rKFxcZHsxLDN9KSwoXFxkezEsM30pXFwpLyk7XG4gICAgICAgIGNvbnN0IG1hdGNoQ29sb3JzMyA9IG5ldyBSZWdFeHAoL3JnYlxcKChcXGR7MSwzfSksKFxcZHsxLDN9KSxbIFxcdF0rKFxcZHsxLDN9KVxcKS8pXG4gICAgICAgIHJldHVybiBtYXRjaENvbG9yczEudGVzdChjb2xvcikgfHwgbWF0Y2hDb2xvcnMyLnRlc3QoY29sb3IpIHx8IG1hdGNoQ29sb3JzMy50ZXN0KGNvbG9yKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrSXNOYW4odmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIE51bWJlci5pc05hTih2YWx1ZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbnZhbGlkVG9hc3Qob3B0aW9uTmFtZSwgb3B0aW9uVHlwZSkge1xuICAgICAgICBzd2l0Y2ggKG9wdGlvblR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ251bSc6XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5zbmFja2Jhci5vcGVuKGBJbnZhbGlkICR7b3B0aW9uTmFtZX0gKG51bWJlciBvciBmbG9hdCkgZ2l2ZW4sIHRha2luZyBkZWZhdWx0IHZhbHVlIGluc3RlYWQuYCwgJ09LJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyZ2InOlxuICAgICAgICAgICAgICAgIC8vIHRoaXMuc25hY2tiYXIub3BlbihgSW52YWxpZCAke29wdGlvbk5hbWV9IGZvcm1hdCBFZzogcmdiKDI1NSwgMjU1LCAyNTUpICBnaXZlbiwgdGFraW5nIGRlZmF1bHQgdmFsdWUgaW5zdGVhZC5gLCAnT0snKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0RhdGFVUkwocykge1xuICAgICAgICBpZiAocykge1xuICAgICAgICAgICAgY29uc3QgcmVnZXggPSAvXlxccypkYXRhOihbYS16XStcXC9bYS16XSsoO1thLXpcXC1dK1xcPVthLXpcXC1dKyk/KT8oO2Jhc2U2NCk/LFthLXowLTlcXCFcXCRcXCZcXCdcXCxcXChcXClcXCpcXCtcXCxcXDtcXD1cXC1cXC5cXF9cXH5cXDpcXEBcXC9cXD9cXCVcXHNdKlxccyokL2k7XG4gICAgICAgICAgICByZXR1cm4gISFzLm1hdGNoKHJlZ2V4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==